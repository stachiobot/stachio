generator clientStachio {
  provider = "prisma-client-js"
  output   = "../../packages/core/prisma/stachio"
}

datasource stachio_db {
  provider = "mysql"
  url      = env("DATABASE_URL_STACHIO")
}

model GuildConfig {
  guildId            String          @unique
  guildName          String?
  language           String          @default("en-US")
  errorLogChannelId  String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  WatchdogConfig     WatchdogConfig?

  // â¬‡ Blacklist check usage tracking
  blacklistCheckUsage     Int      @default(0)
  blacklistCheckLastReset DateTime @default(now())
}

model WatchdogConfig {
  id      Int         @id @default(autoincrement())
  guildId String      @unique
  guild   GuildConfig @relation(fields: [guildId], references: [guildId])

  generalPunishment     PunishmentType @default(WARN)
  fivemPunishment       PunishmentType @default(WARN)
  marketplacePunishment PunishmentType @default(WARN)

  logChannelId String?
  roleId       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum PunishmentType {
  NONE
  WARN
  ROLE
  KICK
  BAN
}

model BlacklistedUser {
  id        Int    @id @default(autoincrement())
  discordId String @unique
  username  String

  blacklists BlacklistEntry[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BlacklistEntry {
  id     Int             @id @default(autoincrement())
  user   BlacklistedUser @relation(fields: [userId], references: [id])
  userId Int

  usercategory UserCategory    @default(General)
  usertype     UserType        @default(ToxicBehavior)
  status       BlacklistStatus @default(INDEFINITE)
  community    String?
  reason       String?
  reportedBy   String?
  evidence     String?         @stachio_db.LongText

  active    Boolean   @default(true)
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

enum UserCategory {
  General
  FiveM
  Marketplace
}

enum UserType {
  ToxicBehavior
  Impersonator
  Advertiser
  Phisher
  DataLeaker
  DDoSer
  ServerRaider
  NSFWDistributor
  AltAccount

  Cheater
  ExploitAbuser
  ExploitDeveloper
  DeveloperAbuse

  // Marketplace
  Scammer
  Chargebacker
  FraudulentSeller
  AccountSeller
}

enum BlacklistStatus {
  PERMANENT
  TEMPORARY
  INDEFINITE
}

model Report {
  id               Int          @id @default(autoincrement())
  reporterId       String
  reporterUsername String
  reportedUser     String
  reason           String
  evidence         String?
  channelId        String?      @unique
  status           ReportStatus @default(OPEN)
  closedBy         String?
  closedReason     String?
  closedAt         DateTime?
  transcriptId     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ReportStatus {
  OPEN
  CLOSED
}

model Appeal {
  id           Int          @id @default(autoincrement())
  userId       String
  username     String?
  guildId      String?
  reason       String
  evidence     String?      @stachio_db.LongText
  status       AppealStatus @default(PENDING)
  reviewedBy   String?
  reviewedAt   DateTime?
  response     String?      @stachio_db.LongText
  channelId    String?      @unique
  transcriptId String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
}

enum AppealStatus {
  PENDING
  APPROVED
  DENIED
}
